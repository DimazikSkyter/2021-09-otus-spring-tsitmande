DROP TABLE IF EXISTS BOOKS;
DROP TABLE IF EXISTS GENRE;
DROP TABLE IF EXISTS AUTHOR;
DROP TABLE IF EXISTS COMMENTS;

CREATE TABLE AUTHORS
(
    ID     BIGINT GENERATED BY DEFAULT AS IDENTITY,
    AUTHOR VARCHAR(255) UNIQUE,
    PRIMARY KEY(ID)
);

CREATE TABLE GENRES
(
    ID    BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    GENRE VARCHAR(255) UNIQUE
);

CREATE TABLE COMMENTS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    book_id bigint,
    comment varchar(255)
);

CREATE TABLE BOOKS
(
    ID        BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME      VARCHAR(255),
    AUTHOR_ID BIGINT,
    CONSTRAINT UC_Book UNIQUE (NAME, AUTHOR_ID)
);

CREATE TABLE BOOKS_GENRES
(
    ID       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BOOK_ID  bigint not null,
    GENRE_ID bigint not null,
    CONSTRAINT UC_Book_genre UNIQUE (BOOK_ID, GENRE_ID)
);

create table avatars(
                        id BIGINT  primary key,
                        photo_url varchar(8000)
);

ALTER TABLE BOOKS_GENRES
    ADD CONSTRAINT fk_books_genres_genres FOREIGN KEY (GENRE_ID) REFERENCES GENRES (ID);
ALTER TABLE BOOKS_GENRES
    ADD CONSTRAINT fk_books_genres_books FOREIGN KEY (BOOK_ID) REFERENCES BOOKS (ID);
ALTER TABLE BOOKS
    ADD CONSTRAINT fk_author FOREIGN KEY (AUTHOR_ID) REFERENCES AUTHORS (ID);
ALTER TABLE COMMENTS
    ADD CONSTRAINT fk_comments_books FOREIGN KEY (book_id) REFERENCES BOOKS (ID);